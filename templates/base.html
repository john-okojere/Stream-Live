{% load static nav %}
<!doctype html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  <title>{% block title %}Layers of Truth | Streaming Ministry{% endblock %}</title>
  {% block meta %}
  <meta name="description" content="Live streaming ministry. Listen to sermons, worship, and biblical teachings from Layers of Truth." />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Layers of Truth | Streaming Ministry" />
  <meta property="og:description" content="Live streaming ministry. Listen to sermons, worship, and biblical teachings from Layers of Truth." />
  <meta property="og:image" content="{% static 'assets/lot-social.jpg' %}" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta name="twitter:card" content="summary_large_image" />
  {% endblock meta %}

  <link rel="icon" href="{% static 'img/lot-logo-black.png' %}" type="image/png" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

  <meta name="theme-color" content="#0b1222">
  <meta name="color-scheme" content="dark light">

  <style>
    :root {
      /* Color System */
      --bg: #0b1222;
      --bg-elevated: #111a30;
      --bg-surface: #1a243f;
      --bg-card: #222d4a;
      --bg-overlay: rgba(11, 18, 34, 0.95);
      
      --text-primary: #f8fafc;
      --text-secondary: #cbd5e1;
      --text-muted: #94a3b8;
      --text-accent: #7b8cff;
      
      --accent-primary: #7b8cff;
      --accent-secondary: #d248ff;
      --accent-gradient: linear-gradient(135deg, #7b8cff, #d248ff);
      --accent-success: #10b981;
      --accent-warning: #f59e0b;
      --accent-danger: #ef4444;
      --accent-live: #ff6a95;
      
      --border-light: rgba(255, 255, 255, 0.12);
      --border-medium: rgba(255, 255, 255, 0.16);
      --border-heavy: rgba(255, 255, 255, 0.2);
      
      /* Spacing */
      --space-xs: 0.25rem;
      --space-sm: 0.5rem;
      --space-md: 1rem;
      --space-lg: 1.5rem;
      --space-xl: 2rem;
      --space-2xl: 3rem;
      --space-3xl: 4rem;
      
      /* Border Radius */
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;
      --radius-2xl: 28px;
      --radius-full: 9999px;
      
      /* Shadows */
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.2);
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.25);
      --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.3);
      --shadow-xl: 0 16px 48px rgba(0, 0, 0, 0.35);
      --shadow-2xl: 0 24px 64px rgba(0, 0, 0, 0.4);
      
      /* Transitions */
      --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
      --transition-base: 250ms cubic-bezier(0.4, 0, 0.2, 1);
      --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
      
      /* Layout */
      --nav-height: 72px;
      --player-height: 88px;
      --sidebar-width: 320px;
      --container-max: 1440px;
    }

    /* Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html {
      scroll-behavior: smooth;
      scroll-padding-top: calc(var(--nav-height) + var(--space-md));
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: 
        radial-gradient(1000px 800px at 10% -10%, rgba(123, 140, 255, 0.15), transparent 40%),
        radial-gradient(900px 700px at 95% 20%, rgba(210, 72, 255, 0.12), transparent 35%),
        linear-gradient(180deg, var(--bg) 0%, #090f1d 100%);
      color: var(--text-primary);
      min-height: 100vh;
      padding-top: var(--nav-height);
      padding-bottom: var(--player-height);
      background-attachment: fixed;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Utility Classes */
    .glass-panel {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
    }

    .glass-card {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
    }

    .gradient-text {
      background: var(--accent-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .gradient-border {
      position: relative;
      background: var(--bg-surface);
      border-radius: var(--radius-lg);
    }

    .gradient-border::before {
      content: '';
      position: absolute;
      inset: -1px;
      background: var(--accent-gradient);
      border-radius: inherit;
      z-index: -1;
      opacity: 0.3;
    }

    .hover-lift {
      transition: transform var(--transition-base);
    }

    .hover-lift:hover {
      transform: translateY(-4px);
    }

    .hover-glow:hover {
      box-shadow: 0 0 20px rgba(123, 140, 255, 0.3);
    }

    .pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .slide-in-left {
      animation: slideInLeft 0.5s ease-out;
    }

    @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    /* Top Gradient Bar */
    .lot-gradient-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--accent-gradient);
      background-size: 200% 200%;
      animation: gradientFlow 8s ease infinite;
      z-index: 1110;
      box-shadow: 0 2px 16px rgba(123, 140, 255, 0.4);
    }

    @keyframes gradientFlow {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    /* Modern Navigation */
    .lot-navbar {
      position: fixed;
      top: 4px;
      left: 0;
      right: 0;
      height: var(--nav-height);
      background: rgba(19, 29, 51, 0.92);
      backdrop-filter: saturate(180%) blur(20px);
      border-bottom: 1px solid var(--border-light);
      z-index: 1100;
      box-shadow: var(--shadow-lg);
    }

    .nav-brand {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      color: white;
      text-decoration: none;
      font-weight: 900;
      font-size: 1.5rem;
      letter-spacing: -0.025em;
    }

    .nav-logo {
      height: 44px;
      width: auto;
      filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.3));
    }

    /* Live Status Badge */
    .live-status-badge {
      display: inline-flex;
      align-items: center;
      gap: var(--space-sm);
      padding: var(--space-sm) var(--space-md);
      background: var(--accent-gradient);
      border-radius: var(--radius-full);
      color: white;
      font-weight: 700;
      font-size: 0.875rem;
      text-decoration: none;
      position: relative;
      overflow: hidden;
      border: none;
      cursor: pointer;
      transition: all var(--transition-base);
      box-shadow: 0 4px 20px rgba(123, 140, 255, 0.3);
    }

    .live-status-badge:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 28px rgba(123, 140, 255, 0.4);
    }

    .live-status-badge::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, transparent 30%, rgba(255, 255, 255, 0.2) 50%, transparent 70%);
      transform: translateX(-100%);
      animation: shine 3s infinite;
    }

    @keyframes shine {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .live-pulse {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #ff6a95;
      box-shadow: 0 0 0 0 rgba(255, 106, 149, 0.7);
      animation: livePulse 2s infinite;
    }

    @keyframes livePulse {
      0% {
        box-shadow: 0 0 0 0 rgba(255, 106, 149, 0.7);
        transform: scale(1);
      }
      70% {
        box-shadow: 0 0 0 12px rgba(255, 106, 149, 0);
        transform: scale(1.1);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(255, 106, 149, 0);
        transform: scale(1);
      }
    }

    /* Navigation Links */
    .nav-link {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      padding: var(--space-sm) var(--space-md);
      color: var(--text-secondary);
      text-decoration: none;
      font-weight: 600;
      border-radius: var(--radius-md);
      transition: all var(--transition-base);
      position: relative;
    }

    .nav-link:hover {
      background: rgba(255, 255, 255, 0.05);
      color: var(--text-primary);
      transform: translateY(-1px);
    }

    .nav-link.active {
      background: rgba(123, 140, 255, 0.15);
      color: var(--text-primary);
    }

    .nav-link.active::before {
      content: '';
      position: absolute;
      left: 0;
      right: 0;
      bottom: -4px;
      height: 2px;
      background: var(--accent-gradient);
      border-radius: var(--radius-full);
    }

    /* Live Floating Action Button */
    .live-fab {
      position: fixed;
      right: var(--space-xl);
      bottom: calc(var(--player-height) + var(--space-xl));
      z-index: 1050;
      display: flex;
      align-items: center;
      gap: var(--space-md);
      padding: var(--space-md);
      background: var(--bg-surface);
      border: 1px solid var(--border-medium);
      border-radius: var(--radius-lg);
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow-xl);
      transition: all var(--transition-base);
      max-width: 400px;
      width: calc(100% - var(--space-xl) * 2);
      animation: slideInUp 0.5s ease-out;
    }

    @keyframes slideInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .live-fab:hover {
      transform: translateY(-4px);
      border-color: var(--accent-primary);
      box-shadow: 0 24px 48px rgba(0, 0, 0, 0.4);
    }

    .live-fab-content {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      flex: 1;
      min-width: 0;
    }

    .live-fab-text {
      flex: 1;
      min-width: 0;
    }

    .live-fab-title {
      font-size: 0.875rem;
      font-weight: 700;
      color: var(--accent-primary);
      margin-bottom: 2px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .live-fab-subtitle {
      font-size: 0.875rem;
      color: var(--text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Player */
    .lot-player {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: var(--player-height);
      background: rgba(19, 29, 51, 0.98);
      backdrop-filter: saturate(180%) blur(30px);
      border-top: 1px solid var(--border-light);
      z-index: 1000;
      box-shadow: 0 -20px 60px rgba(0, 0, 0, 0.4);
    }

    .player-container {
      height: 100%;
      display: flex;
      align-items: center;
      gap: var(--space-lg);
    }

    .player-cover {
      width: 56px;
      height: 56px;
      border-radius: var(--radius-md);
      object-fit: cover;
      background: var(--bg-card);
      border: 1px solid var(--border-light);
      flex-shrink: 0;
    }

    .player-info {
      flex: 1;
      min-width: 0;
    }

    .player-title {
      font-weight: 600;
      font-size: 0.95rem;
      color: var(--text-primary);
      margin-bottom: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .player-artist {
      font-size: 0.85rem;
      color: var(--text-muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .player-controls {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      flex-shrink: 0;
    }

    .player-btn {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      transition: all var(--transition-fast);
    }

    .player-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: var(--border-medium);
      transform: translateY(-1px);
    }

    .player-btn-primary {
      background: var(--accent-gradient);
      border: none;
      color: white;
      width: 44px;
      height: 44px;
    }

    .player-btn-primary:hover {
      background: var(--accent-gradient);
      opacity: 0.9;
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(123, 140, 255, 0.4);
    }

    .player-seek {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      height: 3px;
      background: var(--border-light);
      overflow: hidden;
    }

    .player-seek-fill {
      height: 100%;
      background: var(--accent-gradient);
      width: 0%;
      transition: width 100ms linear;
    }

    /* Live Drawer */
    .live-drawer {
      background: var(--bg-surface);
      border-top: 1px solid var(--border-medium);
      box-shadow: 0 -20px 60px rgba(0, 0, 0, 0.4);

    }

    .live-player-embed {
      background: rgba(0, 0, 0, 0.2);
      border-radius: var(--radius-lg);
      overflow: hidden;
      border: 1px solid var(--border-medium);
      position: relative;
      width: 100%;
      aspect-ratio: 16 / 9;
      height: 400px;
    }

    .live-player-embed iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
    }

    .live-info-card {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
    }

    .live-info-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: var(--space-md);
    }

    .live-info-item {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      padding: var(--space-sm) 0;
      border-bottom: 1px solid var(--border-light);
    }

    .live-info-item:last-child {
      border-bottom: none;
    }

    .live-info-label {
      font-size: 0.875rem;
      color: var(--text-muted);
      min-width: 80px;
    }

    .live-info-value {
      font-size: 0.95rem;
      color: var(--text-primary);
      font-weight: 500;
      flex: 1;
    }

    /* Queue Drawer */
    .queue-drawer {
      background: var(--bg-surface);
      border-left: 1px solid var(--border-medium);
      box-shadow: -20px 0 60px rgba(0, 0, 0, 0.4);
    }

    .queue-item {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      padding: var(--space-md);
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      margin-bottom: var(--space-sm);
      transition: all var(--transition-fast);
      cursor: pointer;
    }

    .queue-item:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: var(--border-medium);
      transform: translateX(4px);
    }

    .queue-item.active {
      background: rgba(123, 140, 255, 0.1);
      border-color: var(--accent-primary);
    }

    .queue-item-cover {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-md);
      object-fit: cover;
      background: var(--bg-card);
      border: 1px solid var(--border-light);
      flex-shrink: 0;
    }

    .queue-item-info {
      flex: 1;
      min-width: 0;
    }

    .queue-item-title {
      font-weight: 500;
      font-size: 0.9rem;
      color: var(--text-primary);
      margin-bottom: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .queue-item-meta {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* Mobile Offcanvas */
    .mobile-offcanvas {
      background: var(--bg-surface);
      border-right: 1px solid var(--border-medium);
      box-shadow: 20px 0 60px rgba(0, 0, 0, 0.4);
    }

    /* Messages */
    .lot-messages {
      position: fixed;
      top: calc(var(--nav-height) + var(--space-md));
      left: 50%;
      transform: translateX(-50%);
      width: min(100%, 600px);
      z-index: 1090;
      padding: 0 var(--space-md);
    }

    .alert {
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: var(--shadow-lg);
      animation: slideDown 0.3s ease-out;
    }

    /* Footer */
    .lot-footer {
      background: rgba(9, 15, 29, 0.95);
      border-top: 1px solid var(--border-light);
      margin-top: var(--space-3xl);
      padding: var(--space-2xl) 0;
    }

    .footer-logo {
      height: 40px;
      width: auto;
      filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.3));
    }

    .footer-links {
      display: flex;
      gap: var(--space-lg);
      justify-content: center;
    }

    .footer-link {
      color: var(--text-muted);
      text-decoration: none;
      transition: color var(--transition-fast);
    }

    .footer-link:hover {
      color: var(--text-primary);
    }

    /* Radio.co Integration */
    .radio-status-indicator {
      display: inline-flex;
      align-items: center;
      gap: var(--space-sm);
      padding: var(--space-xs) var(--space-sm);
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-full);
      font-size: 0.75rem;
      font-weight: 600;
    }

    .radio-status-indicator.online {
      background: rgba(16, 185, 129, 0.1);
      border-color: rgba(16, 185, 129, 0.3);
      color: #10b981;
    }

    .radio-status-indicator.offline {
      background: rgba(239, 68, 68, 0.1);
      border-color: rgba(239, 68, 68, 0.3);
      color: #ef4444;
    }

    .radio-album-art {
      width: 64px;
      height: 64px;
      border-radius: var(--radius-md);
      object-fit: cover;
      background: var(--bg-card);
      border: 1px solid var(--border-light);
    }

    /* Responsive Design */
    @media (max-width: 992px) {
      :root {
        --nav-height: 64px;
        --player-height: 80px;
        --space-xl: 1rem;
      }

      .live-fab {
        right: var(--space-md);
        left: var(--space-md);
        width: auto;
        bottom: calc(var(--player-height) + var(--space-lg));
      }

      .nav-brand span {
        display: none;
      }

      .player-container {
        gap: var(--space-md);
      }

      .player-cover {
        width: 48px;
        height: 48px;
      }
    }

    @media (max-width: 768px) {
      .live-fab-content {
        flex-direction: column;
        align-items: flex-start;
        gap: var(--space-sm);
      }

      .live-fab-text {
        width: 100%;
      }

      .live-fab-subtitle {
        font-size: 0.8rem;
      }

      .player-controls {
        position: absolute;
        bottom: var(--space-sm);
        left: 0;
        right: 0;
        justify-content: center;
        background: rgba(19, 29, 51, 0.95);
        backdrop-filter: blur(20px);
        padding: var(--space-sm);
      }

      .player-info {
        text-align: center;
        margin-bottom: var(--space-xl);
      }
    }

    @media (max-width: 576px) {
      .live-fab {
        flex-direction: column;
        align-items: stretch;
      }

      .live-fab-content {
        flex-direction: row;
        align-items: center;
      }

      .live-fab-text {
        flex: 1;
      }

      .player-btn {
        width: 32px;
        height: 32px;
      }

      .player-btn-primary {
        width: 40px;
        height: 40px;
      }

      .live-player-embed {
        min-height: 330px;
        aspect-ratio: 16 / 9;
      }
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: var(--radius-full);
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: var(--radius-full);
      border: 2px solid transparent;
      background-clip: padding-box;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    /* Selection */
    ::selection {
      background: rgba(123, 140, 255, 0.3);
      color: white;
    }

    /* Focus Styles */
    :focus-visible {
      outline: 2px solid var(--accent-primary);
      outline-offset: 2px;
    }

    /* Loading States */
    .loading-skeleton {
      background: linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
      border-radius: var(--radius-md);
    }

    @keyframes loading {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }

    /* Print Styles */
    @media print {
      .lot-player,
      .live-fab,
      .lot-navbar,
      .lot-gradient-bar {
        display: none !important;
      }

      body {
        padding: 0;
        background: white;
        color: black;
      }
    }
  </style>
  <style>
    .live-drawer{
      height: 90vh !important;
    }
    @media screen and (min-width:960px) {
      .live-drawer{
        height: 60vh !important;
      }
    }
  </style>
  {% block head %}{% endblock %}
</head>
<body data-default-cover="{% static 'assets/LOT-LOGO-PNG-WHITE.png' %}">
  <div class="lot-gradient-bar" aria-hidden="true"></div>

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg lot-navbar">
    <div class="container-fluid px-3 px-lg-4 h-100">
      <!-- Brand & Live Status -->
      <div class="d-flex align-items-center gap-3">
        <a href="{% url 'stream:past_list' %}" class="nav-brand">
          <img src="{% static 'assets/LOT-LOGO-PNG-WHITE.png' %}" alt="Layers of Truth" class="nav-logo">
        </a>
        
        <button class="live-status-badge" 
                data-bs-toggle="offcanvas" 
                data-bs-target="#liveDrawer"
                aria-label="Live Stream Status">
          <i class="bi bi-broadcast-pin"></i>
          <span class="d-none d-sm-inline">LIVE</span>
          <span class="live-pulse" aria-hidden="true"></span>
        </button>
      </div>

      <!-- Desktop Navigation -->
      <div class="d-none d-lg-flex align-items-center gap-3">
        <a href="{% url 'stream:past_list' %}" 
           class="nav-link {% if request.resolver_match.url_name|inlist:'past_list' %}active{% endif %}">
          <i class="bi bi-journal-music"></i>
          <span>Streams</span>
        </a>
        
        {% if request.user.is_staff %}
          <a href="{% url 'stream:staff_dashboard' %}" 
             class="nav-link {% if request.resolver_match.url_name == 'staff_dashboard' %}active{% endif %}">
            <i class="bi bi-speedometer2"></i>
            <span>Dashboard</span>
          </a>
          
          <a href="{% url 'stream:upload_sermon' %}" 
             class="nav-link {% if request.resolver_match.url_name == 'upload_sermon' %}active{% endif %}">
            <i class="bi bi-cloud-upload"></i>
            <span>Upload</span>
          </a>
        {% endif %}
        
        <!-- Queue Button -->
        <button class="btn btn-outline-light position-relative" 
                data-bs-toggle="offcanvas" 
                data-bs-target="#queueDrawer"
                aria-label="Queue">
          <i class="bi bi-music-note-list"></i>
          <span class="d-none d-sm-inline ms-1">Queue</span>
          <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-primary" 
                id="queueCount">0</span>
        </button>
      </div>

      <!-- Mobile Menu Toggle -->
      <button class="btn btn-outline-light d-lg-none" 
              type="button" 
              data-bs-toggle="offcanvas" 
              data-bs-target="#mobileOffcanvas"
              aria-label="Open menu">
        <i class="bi bi-list"></i>
      </button>
    </div>
  </nav>

  <!-- Live FAB -->
  <div class="live-fab glass-panel" id="liveFab">
    <div class="live-fab-content">
      <span class="live-pulse"></span>
      <div class="live-fab-text">
        <div class="live-fab-title" id="liveFabStatus">LIVE NOW</div>
        <div class="live-fab-subtitle" id="liveFabSong">Loading current song...</div>
      </div>
    </div>
    <button class="btn btn-primary btn-sm" 
            data-bs-toggle="offcanvas" 
            data-bs-target="#liveDrawer"
            aria-label="Listen Live">
      <i class="bi bi-play-fill me-1"></i> Listen
    </button>
  </div>

  <!-- Main Content -->
  <main id="main" class="container-fluid px-3 px-lg-4 py-4">
    {% if messages %}
      <div class="lot-messages">
        {% for message in messages %}
          <div class="alert alert-{{ message.tags|default:'info' }} alert-dismissible fade show" role="alert">
            <div class="d-flex align-items-center gap-2">
              {% if message.tags == 'success' %}
                <i class="bi bi-check-circle-fill"></i>
              {% elif message.tags == 'error' or message.tags == 'danger' %}
                <i class="bi bi-x-circle-fill"></i>
              {% elif message.tags == 'warning' %}
                <i class="bi bi-exclamation-triangle-fill"></i>
              {% else %}
                <i class="bi bi-info-circle-fill"></i>
              {% endif %}
              <span>{{ message }}</span>
            </div>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    {% block content %}{% endblock %}
  </main>

  <!-- Footer -->
  <footer class="lot-footer">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-lg-4 mb-4 mb-lg-0">
          <div class="d-flex align-items-center gap-3">
            <img src="{% static 'assets/LOT-LOGO-PNG-WHITE.png' %}" alt="Layers of Truth" class="footer-logo">
            <div>
              <div class="fw-bold">Layers of Truth</div>
              <div class="text-muted small">Unveiling spiritual insights</div>
            </div>
          </div>
        </div>
        
        <div class="col-lg-4 mb-4 mb-lg-0 text-center">
          <div class="text-muted small">&copy; {% now "Y" %} Layers of Truth. All rights reserved.</div>
        </div>
        
        <div class="col-lg-4">
          <div class="footer-links">
            <a href="https://layersoftruth.org/" target="_blank" class="footer-link">
              <i class="bi bi-globe"></i>
            </a>
            <a href="https://x.com/Layers_of_Truth" target="_blank" class="footer-link">
              <i class="bi bi-twitter-x"></i>
            </a>
            <a href="https://www.youtube.com/@layersoftruth_ng" target="_blank" class="footer-link">
              <i class="bi bi-youtube"></i>
            </a>
            <a href="https://www.instagram.com/layersoftruth_ng/" target="_blank" class="footer-link">
              <i class="bi bi-instagram"></i>
            </a>
            <a href="https://www.facebook.com/layersoftruthng/" target="_blank" class="footer-link">
              <i class="bi bi-facebook"></i>
            </a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <!-- Player -->
  <div id="lot-player" class="lot-player">
    <div class="player-seek">
      <div class="player-seek-fill" id="lot-seek-fill"></div>
    </div>
    
    <div class="container h-100">
      <div class="player-container">
        <!-- Cover Art -->
        <img id="lot-cover" class="player-cover" alt="Cover Art">
        
        <!-- Track Info -->
        <div class="player-info">
          <div id="lot-title" class="player-title">Not Playing</div>
          <div id="lot-artist" class="player-artist">Select a sermon to begin</div>
        </div>
        
        <!-- Controls -->
        <div class="player-controls">
          <button class="player-btn" id="lot-shuffle" title="Shuffle">
            <i class="bi bi-shuffle"></i>
          </button>
          
          <button class="player-btn" id="lot-prev" title="Previous">
            <i class="bi bi-skip-start-fill"></i>
          </button>
          
          <button class="player-btn player-btn-primary" id="lot-toggle" title="Play">
            <i class="bi bi-play-fill"></i>
          </button>
          
          <button class="player-btn" id="lot-next" title="Next">
            <i class="bi bi-skip-end-fill"></i>
          </button>
          
          <button class="player-btn" id="lot-repeat" title="Repeat">
            <i class="bi bi-repeat"></i>
          </button>
          
          <select class="form-select form-select-sm ms-2" id="lot-speed" style="width: 90px;">
            <option value="0.8">0.8×</option>
            <option value="1" selected>1×</option>
            <option value="1.25">1.25×</option>
            <option value="1.5">1.5×</option>
            <option value="2">2×</option>
          </select>
          
          <button class="player-btn" 
                  data-bs-toggle="offcanvas" 
                  data-bs-target="#queueDrawer"
                  title="Queue">
            <i class="bi bi-music-note-list"></i>
          </button>
        </div>
      </div>
    </div>
    
    <audio id="lot-audio" preload="metadata"></audio>
  </div>

  <!-- Live Drawer -->
  <div class="offcanvas offcanvas-bottom live-drawer" 
       tabindex="-1" 
       id="liveDrawer"
       aria-labelledby="liveDrawerLabel">
    <div class="offcanvas-header border-bottom">
      <h5 class="offcanvas-title d-flex align-items-center gap-2" id="liveDrawerLabel">
        <i class="bi bi-broadcast-pin"></i>
        <span>Live Stream</span>
        <span class="radio-status-indicator online ms-2" id="liveStatusBadge">ONLINE</span>
      </h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    
    <div class="offcanvas-body">
      <div class="row g-4">
        <!-- Player -->
        <div class="col-lg-8">
          <div class="live-player-embed">
            <!-- Radio.co Player 1 -->
            <script src="https://embed.radio.co/player/05d5829.js"></script>
            <div class="loading-skeleton" style="height:400px;"></div>
          </div>
          
          <div class="mt-3 d-flex flex-wrap gap-2">
            <a href="https://streaming.radio.co/s1702795f8/listen" 
               target="_blank" 
               class="btn btn-outline-light btn-sm">
              <i class="bi bi-play-fill me-1"></i> Direct Stream (192kbps)
            </a>
            
            <a href="http://streaming.radio.co/s1702795f8/listen.m3u" 
               target="_blank" 
               class="btn btn-outline-light btn-sm">
              <i class="bi bi-list-ul me-1"></i> Playlist (M3U)
            </a>
            
            <button class="btn btn-outline-light btn-sm" onclick="pauseOndemand()">
              <i class="bi bi-pause-fill me-1"></i> Pause On-Demand
            </button>
          </div>
        </div>
        
        <!-- Live Info -->
        <div class="col-lg-4">
          <div class="live-info-card">
            <div class="live-info-title">Now Playing</div>
            
            <div class="live-info-item">
              <div class="live-info-label">Status:</div>
              <div class="live-info-value">
                <span id="radioStatus">Loading...</span>
              </div>
            </div>
            
            <div class="live-info-item">
              <div class="live-info-label">Song:</div>
              <div class="live-info-value" id="radioSong">—</div>
            </div>
            
            <div class="live-info-item">
              <div class="live-info-label">DJ:</div>
              <div class="live-info-value" id="radioDJ">—</div>
            </div>
            
            <div class="live-info-item">
              <div class="live-info-label">Artwork:</div>
              <div class="live-info-value">
                <img id="radioArtwork" class="radio-album-art d-none" alt="Album Art">
                <span id="radioArtworkText" class="text-muted">None</span>
              </div>
            </div>
            
            <div class="mt-4 pt-3 border-top">
              <p class="small text-muted mb-2">
                <i class="bi bi-info-circle me-1"></i>
                When live streaming, on-demand audio will be paused automatically.
              </p>
              <div class="d-flex gap-2">
                <button class="btn btn-primary btn-sm" onclick="openPlayer2()">
                  <i class="bi bi-play-circle me-1"></i> Alternative Player
                </button>
                <button class="btn btn-outline-light btn-sm" data-bs-dismiss="offcanvas">
                  <i class="bi bi-x-lg me-1"></i> Close
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Queue Drawer -->
  <div class="offcanvas offcanvas-end queue-drawer" 
       tabindex="-1" 
       id="queueDrawer"
       aria-labelledby="queueDrawerLabel">
    <div class="offcanvas-header border-bottom">
      <h5 class="offcanvas-title" id="queueDrawerLabel">
        <i class="bi bi-music-note-list me-2"></i>
        Up Next
        <span class="badge bg-primary ms-2" id="queueCountBadge">0</span>
      </h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    
    <div class="offcanvas-body">
      <div class="d-flex gap-2 mb-3">
        <button class="btn btn-outline-light btn-sm" id="queueShuffle">
          <i class="bi bi-shuffle me-1"></i> Shuffle
        </button>
        <button class="btn btn-outline-danger btn-sm ms-auto" id="queueClear">
          <i class="bi bi-trash3 me-1"></i> Clear All
        </button>
      </div>
      
      <div id="queueList" class="queue-list">
        <!-- Queue items will be inserted here -->
        <div class="text-center text-muted py-5">
          <i class="bi bi-music-note-list display-6 mb-3"></i>
          <p>Your queue is empty</p>
          <p class="small">Add sermons from the library to get started</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile Offcanvas -->
  <div class="offcanvas offcanvas-start mobile-offcanvas" 
       tabindex="-1" 
       id="mobileOffcanvas"
       aria-labelledby="mobileOffcanvasLabel">
    <div class="offcanvas-header border-bottom">
      <div class="d-flex align-items-center gap-3">
        <img src="{% static 'assets/LOT-LOGO-PNG-WHITE.png' %}" alt="Layers of Truth" style="height: 36px;">
        <h5 class="offcanvas-title gradient-text fw-bold mb-0">Menu</h5>
      </div>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    
    <div class="offcanvas-body d-flex flex-column gap-4">
      <!-- Search -->
      <div class="mb-3">
        <h6 class="fw-bold mb-3">Search Sermons</h6>
        <form id="mobileSearch" class="d-flex gap-2" role="search">
          <div class="flex-grow-1 position-relative">
            <input type="search" class="form-control glass-panel border-0" 
                   placeholder="Title, speaker, tag..." 
                   aria-label="Search sermons">
            <i class="bi bi-search position-absolute top-50 end-3 translate-middle-y text-muted"></i>
          </div>
          <button type="submit" class="btn btn-primary">
            <i class="bi bi-search"></i>
          </button>
        </form>
      </div>
      
      <!-- Navigation -->
      <div>
        <h6 class="fw-bold mb-3">Navigation</h6>
        <div class="d-flex flex-column gap-2">
          <a href="{% url 'stream:past_list' %}" class="nav-link">
            <i class="bi bi-journal-music"></i>
            All Streams
          </a>
          
          {% if request.user.is_staff %}
            <a href="{% url 'stream:staff_dashboard' %}" class="nav-link">
              <i class="bi bi-speedometer2"></i>
              Dashboard
            </a>
            
            <a href="{% url 'stream:upload_sermon' %}" class="nav-link">
              <i class="bi bi-cloud-upload"></i>
              Upload Sermon
            </a>
          {% endif %}
          
          <a href="https://store.layersoftruth.org" target="_blank" class="nav-link">
            <i class="bi bi-bag-heart"></i>
            Store
          </a>
        </div>
      </div>
      
      <!-- Quick Picks -->
      <div>
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h6 class="fw-bold mb-0">Quick Picks</h6>
          <button class="btn btn-outline-light btn-sm" id="mobileShuffle">
            <i class="bi bi-shuffle"></i>
          </button>
        </div>
        
        <div id="mobileQuickList" class="d-flex flex-column gap-2">
          <!-- Quick picks will be loaded here -->
          <div class="loading-skeleton" style="height: 60px;"></div>
          <div class="loading-skeleton" style="height: 60px;"></div>
          <div class="loading-skeleton" style="height: 60px;"></div>
        </div>
      </div>
      
      <!-- Tags -->
      <div>
        <h6 class="fw-bold mb-3">Popular Tags</h6>
        <div id="mobileTags" class="d-flex flex-wrap gap-2">
          <!-- Tags will be loaded here -->
          <span class="loading-skeleton" style="width: 80px; height: 32px;"></span>
          <span class="loading-skeleton" style="width: 60px; height: 32px;"></span>
          <span class="loading-skeleton" style="width: 100px; height: 32px;"></span>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script defer src="{% static 'assets/player.js' %}"></script>
  
  <!-- Radio.co Integration
  <script src="https://embed.radio.co/embed/s1702795f8/status.js"></script>
  <script src="https://embed.radio.co/embed/s1702795f8/dj.js"></script>
  <script src="https://embed.radio.co/embed/s1702795f8/artwork.js"></script>
  <script src="https://embed.radio.co/embed/s1702795f8/song.js"></script> -->
  
  <!-- Alternative Player container (script loaded on demand) -->
  <div id="player2Container" style="display: none;"></div>

  <script>
  const img = document.querySelectorAll("current-artwork");
  img.forEach(element => element.removeAttribute("crossorigin"));
  // Global configuration
  const LOT_CONFIG = {
    radioStation: 's1702795f8',
    apiBase: '{% url "stream:sidebar_summary_json" %}',
    statusUrl: 'https://public.radio.co/stations/s1702795f8/status'
  };

  // Suppress noisy CORS image errors from the radio.co artwork host
  window.addEventListener('error', function (e) {
    const t = e.target || {};
    const src = t.src || "";
    if (t.tagName === 'IMG' && src.includes('media.radio.co/artwork')) {
      e.preventDefault();
    }
  }, true);

  // Initialize when DOM is ready
  document.addEventListener('DOMContentLoaded', function() {
    initializeRadioIntegration();
    initializeUI();
    initializeEventListeners();
  });

  // Radio.co Integration
  function initializeRadioIntegration() {
    // Status updates
    setInterval(() => {
      fetchRadioStatus();
    }, 30000); // Update every 30 seconds

    fetchRadioStatus();
  }

  async function fetchRadioStatus() {
    try {
      const response = await fetch(LOT_CONFIG.statusUrl);
      const data = await response.json();
      
      const isOnline = data.status === 'online';
      const song = data.current_track?.title || 'No song information';
      const dj = data.current_track?.artist || 'Layers of Truth';
      const artwork = data.current_track?.artwork_url;
      
      // Update UI
      updateLiveStatus(isOnline, song, dj, artwork);
    } catch (error) {
      console.error('Failed to fetch radio status:', error);
      updateLiveStatus(false, 'Connection Error', '—', null);
    }
  }

  function updateLiveStatus(isOnline, song, dj, artwork) {
    // Update FAB
    const fabStatus = document.getElementById('liveFabStatus');
    const fabSong = document.getElementById('liveFabSong');
    const statusBadge = document.getElementById('liveStatusBadge');
    
    if (fabStatus) fabStatus.textContent = isOnline ? 'LIVE NOW' : 'OFFLINE';
    if (fabSong) fabSong.textContent = song;
    
    if (statusBadge) {
      statusBadge.textContent = isOnline ? 'ONLINE' : 'OFFLINE';
      statusBadge.className = `radio-status-indicator ${isOnline ? 'online' : 'offline'}`;
    }
    
    // Update drawer info
    const radioStatus = document.getElementById('radioStatus');
    const radioSong = document.getElementById('radioSong');
    const radioDJ = document.getElementById('radioDJ');
    const radioArtwork = document.getElementById('radioArtwork');
    const radioArtworkText = document.getElementById('radioArtworkText');
    
    if (radioStatus) radioStatus.textContent = isOnline ? 'Online' : 'Offline';
    if (radioSong) radioSong.textContent = song;
    if (radioDJ) radioDJ.textContent = dj;
    
    if (artwork) {
      if (radioArtwork) {
        radioArtwork.src = artwork;
        radioArtwork.classList.remove('d-none');
      }
      if (radioArtworkText) {
        radioArtworkText.textContent = '';
      }
    } else {
      if (radioArtwork) radioArtwork.classList.add('d-none');
      if (radioArtworkText) radioArtworkText.textContent = 'None';
    }
    
    // Update live badge pulse
    const livePulse = document.querySelector('.live-pulse');
    if (livePulse) {
      if (isOnline) {
        livePulse.style.animationPlayState = 'running';
      } else {
        livePulse.style.animationPlayState = 'paused';
        livePulse.style.backgroundColor = '#6c757d';
      }
    }
  }

  // UI Initialization
  function initializeUI() {
    // Initialize tooltips
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl);
    });

    // Initialize player seek bar
    const audio = document.getElementById('lot-audio');
    const seekFill = document.getElementById('lot-seek-fill');
    
    if (audio && seekFill) {
      audio.addEventListener('timeupdate', function() {
        const percentage = (audio.currentTime / audio.duration) * 100 || 0;
        seekFill.style.width = `${percentage}%`;
      });
    }

    // Load mobile quick picks
    loadMobileQuickPicks();
  }

  // Event Listeners
  function initializeEventListeners() {
    // Live drawer opens - pause on-demand audio
    const liveDrawer = document.getElementById('liveDrawer');
    const liveFab = document.getElementById('liveFab');
    if (liveDrawer) {
      liveDrawer.addEventListener('shown.bs.offcanvas', function() {
        pauseOndemand();
        liveFab?.classList.add('d-none');
      });
      liveDrawer.addEventListener('hidden.bs.offcanvas', function() {
        liveFab?.classList.remove('d-none');
      });
    }

    // Mobile search
    const mobileSearch = document.getElementById('mobileSearch');
    if (mobileSearch) {
      mobileSearch.addEventListener('submit', function(e) {
        e.preventDefault();
        const query = this.querySelector('input').value;
        if (query) {
          window.location.href = `{% url 'stream:past_list' %}?q=${encodeURIComponent(query)}`;
        }
      });
    }

    // Mobile shuffle
    const mobileShuffle = document.getElementById('mobileShuffle');
    if (mobileShuffle) {
      mobileShuffle.addEventListener('click', function() {
        loadMobileQuickPicks();
      });
    }

    // Queue controls
    const queueShuffle = document.getElementById('queueShuffle');
    const queueClear = document.getElementById('queueClear');
    
    if (queueShuffle) {
      queueShuffle.addEventListener('click', function() {
        if (window.lotPlayer && window.lotPlayer.shuffleQueue) {
          window.lotPlayer.shuffleQueue();
        }
      });
    }
    
    if (queueClear) {
      queueClear.addEventListener('click', function() {
        if (window.lotPlayer && window.lotPlayer.clearQueue) {
          window.lotPlayer.clearQueue();
        }
      });
    }
  }

  // Helper Functions
  function pauseOndemand() {
    const audio = document.getElementById('lot-audio');
    if (audio && !audio.paused) {
      audio.pause();
      
      // Show notification
      showNotification('On-demand audio paused for live stream');
    }
  }

  function openPlayer2() {
    // Create a modal for player 2
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.innerHTML = `
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content glass-panel">
          <div class="modal-header border-bottom">
            <h5 class="modal-title">Alternative Player</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div id="player2Embed" style="min-height: 400px;"></div>
          </div>
        </div>
      </div>
    `;
    
    document.body.appendChild(modal);
    
    const bsModal = new bootstrap.Modal(modal);
    bsModal.show();
    
    // Load player 2 after modal is shown (lazy-load the script once)
    modal.addEventListener('shown.bs.modal', function() {
      const embedDiv = document.getElementById('player2Embed');
      if (embedDiv) {
        if (!window._player2Loaded) {
          const s = document.createElement('script');
          s.src = 'https://embed.radio.co/player/57315ab.js';
          s.onload = ()=> window._player2Loaded = true;
          embedDiv.appendChild(s);
        }
      }
    });
    
    // Clean up on hide
    modal.addEventListener('hidden.bs.modal', function() {
      document.body.removeChild(modal);
    });
  }

  function showNotification(message, type = 'info') {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
    notification.style.cssText = `
      top: 100px;
      right: 20px;
      z-index: 9999;
      max-width: 350px;
      box-shadow: var(--shadow-lg);
    `;
    
    notification.innerHTML = `
      <div class="d-flex align-items-center gap-2">
        <i class="bi bi-${type === 'success' ? 'check-circle' : 'info-circle'}"></i>
        <span>${message}</span>
      </div>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(notification);
    
    // Auto remove after 5 seconds
    setTimeout(() => {
      if (notification.parentNode) {
        notification.remove();
      }
    }, 5000);
  }

  async function loadMobileQuickPicks() {
    const quickList = document.getElementById('mobileQuickList');
    const tagsList = document.getElementById('mobileTags');
    
    if (!quickList || !tagsList) return;
    
    try {
      const response = await fetch(LOT_CONFIG.apiBase);
      const data = await response.json();
      
      // Update quick picks
      if (data.random_items && data.random_items.length > 0) {
        quickList.innerHTML = data.random_items.map(item => `
          <div class="queue-item">
            <img src="${item.cover || ''}" alt="${item.title}" class="queue-item-cover">
            <div class="queue-item-info">
              <div class="queue-item-title">${item.title}</div>
              <div class="queue-item-meta">${item.speaker || ''}</div>
            </div>
            <button class="btn btn-primary btn-sm" 
                    onclick="window.lotPlayer?.playItem('${item.slug}')">
              <i class="bi bi-play-fill"></i>
            </button>
          </div>
        `).join('');
      }
      
      // Update tags
      if (data.top_tags && data.top_tags.length > 0) {
        tagsList.innerHTML = data.top_tags.slice(0, 8).map(tag => `
          <button class="btn btn-outline-light btn-sm" 
                  onclick="window.location.href='{% url 'stream:past_list' %}?tag=${tag.name}'">
            #${tag.name}
          </button>
        `).join('');
      }
    } catch (error) {
      console.error('Failed to load mobile quick picks:', error);
    }
  }

  // Expose functions to global scope
  window.LOT = {
    pauseOndemand,
    openPlayer2,
    showNotification,
    fetchRadioStatus
  };
  </script>

  {% block scripts %}{% endblock %}
</body>
</html>
